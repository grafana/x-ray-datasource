/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/data","@grafana/ui","emotion","lodash","@grafana/runtime","app/core/app_events","prismjs"],(function(e,t,n,r,a,o,i,s){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=14)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),a=n(0),o=r.__importDefault(n(12));t.default=function(e,t){void 0===t&&(t=[]);var n=o.default(e,t,{loading:!0}),r=n[0],i=n[1];return a.useEffect((function(){i()}),[i]),r}},function(e,t){e.exports=o},function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",(function(){return a})),n.d(t,"__assign",(function(){return o})),n.d(t,"__rest",(function(){return i})),n.d(t,"__decorate",(function(){return s})),n.d(t,"__param",(function(){return u})),n.d(t,"__metadata",(function(){return l})),n.d(t,"__awaiter",(function(){return c})),n.d(t,"__generator",(function(){return d})),n.d(t,"__createBinding",(function(){return p})),n.d(t,"__exportStar",(function(){return f})),n.d(t,"__values",(function(){return m})),n.d(t,"__read",(function(){return y})),n.d(t,"__spread",(function(){return h})),n.d(t,"__spreadArrays",(function(){return v})),n.d(t,"__await",(function(){return g})),n.d(t,"__asyncGenerator",(function(){return b})),n.d(t,"__asyncDelegator",(function(){return E})),n.d(t,"__asyncValues",(function(){return w})),n.d(t,"__makeTemplateObject",(function(){return S})),n.d(t,"__importStar",(function(){return T})),n.d(t,"__importDefault",(function(){return x})),n.d(t,"__classPrivateFieldGet",(function(){return R})),n.d(t,"__classPrivateFieldSet",(function(){return A}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function a(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function i(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}function s(e,t,n,r){var a,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i}function u(e,t){return function(n,r){t(n,r,e)}}function l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))}function d(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var p=Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function f(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||p(t,e,n)}function m(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function v(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r}function g(e){return this instanceof g?(this.v=e,this):new g(e)}function b(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),o=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=a[e](t)).value instanceof g?Promise.resolve(n.value.v).then(u,l):c(o[0][2],n)}catch(e){c(o[0][3],e)}var n}function u(e){s("next",e)}function l(e){s("throw",e)}function c(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function E(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,a){t[r]=e[r]?function(t){return(n=!n)?{value:g(e[r](t)),done:"return"===r}:a?a(t):t}:a}}function w(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=m(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,a){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,a,(t=e[n](t)).done,t.value)}))}}}function S(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var _=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&p(t,e,n);return _(t,e),t}function x(e){return e&&e.__esModule?e:{default:e}}function R(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function A(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}},function(e,t,n){"use strict";e.exports=n(11)},function(e,t){e.exports=i},function(e,t){e.exports=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,a,o=n(0),i=(r=o)&&"object"==typeof r&&"default"in r?r.default:r,s=n(2),u=n(1),l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},c=["af-south-1","ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-southeast-1","ap-southeast-2","ca-central-1","cn-north-1","cn-northwest-1","eu-central-1","eu-north-1","eu-west-1","eu-west-2","eu-west-3","me-south-1","sa-east-1","us-east-1","us-east-2","us-gov-east-1","us-gov-west-1","us-iso-east-1","us-isob-east-1","us-west-1","us-west-2"];(a=t.AwsAuthType||(t.AwsAuthType={})).Keys="keys",a.Credentials="credentials",a.Default="default",a.EC2IAMRole="ec2_iam_role",a.ARN="arn";var d=[{label:"Workspace IAM Role",value:t.AwsAuthType.EC2IAMRole},{label:"AWS SDK Default",value:t.AwsAuthType.Default},{label:"Access & secret key",value:t.AwsAuthType.Keys},{label:"Credentials file",value:t.AwsAuthType.Credentials}],p=function(e){return{value:e,label:e}};t.ConnectionConfig=function(e){var n,r,a,f,m,y,h,v,g,b=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}(o.useState((e.standardRegions||c).map(p)),2),E=b[0],w=b[1],S=e.loadRegions,_=e.onOptionsChange,T=e.skipHeader,x=void 0!==T&&T,R=e.skipEndpoint,A=void 0!==R&&R,O=e.options,C=O.jsonData.profile;void 0===C&&(C=O.database);var N=window.grafanaBootData.settings,D=null!==(n=N.awsAllowedAuthProviders)&&void 0!==n?n:[t.AwsAuthType.Default,t.AwsAuthType.Keys,t.AwsAuthType.Credentials],F=null===(r=N.awsAssumeRoleEnabled)||void 0===r||r,I=d.find((function(e){return e.value===O.jsonData.authType}));return o.useEffect((function(){!I&&D.length&&_(l(l({},O),{jsonData:l(l({},O.jsonData),{authType:D[0]})}))}),[I,O,_]),o.useEffect((function(){S&&S().then((function(e){return w(e.map(p))}))}),[S]),i.createElement(s.FieldSet,{label:x?"":"Connection Details","data-testid":"connection-config"},i.createElement(s.InlineField,{label:"Authentication Provider",labelWidth:28,tooltip:"Specify which AWS credentials chain to use."},i.createElement(s.Select,{className:"width-30",value:I,options:d.filter((function(e){return D.includes(e.value)})),defaultValue:O.jsonData.authType,onChange:function(t){u.onUpdateDatasourceJsonDataOptionSelect(e,"authType")(t)}})),"credentials"===O.jsonData.authType&&i.createElement(s.InlineField,{label:"Credentials Profile Name",labelWidth:28,tooltip:"Credentials profile name, as specified in ~/.aws/credentials, leave blank for default."},i.createElement(s.Input,{className:"width-30",placeholder:"default",value:C,onChange:u.onUpdateDatasourceJsonDataOption(e,"profile")})),"keys"===O.jsonData.authType&&i.createElement(i.Fragment,null,i.createElement(s.InlineField,{label:"Access Key ID",labelWidth:28},(null===(a=e.options.secureJsonFields)||void 0===a?void 0:a.accessKey)?i.createElement(s.ButtonGroup,{className:"width-30"},i.createElement(s.Input,{disabled:!0,placeholder:"Configured"}),i.createElement(s.ToolbarButton,{icon:"edit",tooltip:"Edit Access Key ID",type:"button",onClick:u.onUpdateDatasourceResetOption(e,"accessKey")})):i.createElement(s.Input,{className:"width-30",value:null!==(m=null===(f=O.secureJsonData)||void 0===f?void 0:f.accessKey)&&void 0!==m?m:"",onChange:u.onUpdateDatasourceSecureJsonDataOption(e,"accessKey")})),i.createElement(s.InlineField,{label:"Secret Access Key",labelWidth:28},(null===(y=e.options.secureJsonFields)||void 0===y?void 0:y.secretKey)?i.createElement(s.ButtonGroup,{className:"width-30"},i.createElement(s.Input,{disabled:!0,placeholder:"Configured"}),i.createElement(s.ToolbarButton,{icon:"edit",type:"button",tooltip:"Edit Secret Access Key",onClick:u.onUpdateDatasourceResetOption(e,"secretKey")})):i.createElement(s.Input,{className:"width-30",value:null!==(v=null===(h=O.secureJsonData)||void 0===h?void 0:h.secretKey)&&void 0!==v?v:"",onChange:u.onUpdateDatasourceSecureJsonDataOption(e,"secretKey")}))),F&&i.createElement(i.Fragment,null,i.createElement(s.InlineField,{label:"Assume Role ARN",labelWidth:28,tooltip:"Optionally, specify the ARN of a role to assume. Specifying a role here will ensure that the selected authentication provider is used to assume the specified role rather than using the credentials directly. Leave blank if you don't need to assume a role at all"},i.createElement(s.Input,{className:"width-30",placeholder:"arn:aws:iam:*",value:O.jsonData.assumeRoleArn||"",onChange:u.onUpdateDatasourceJsonDataOption(e,"assumeRoleArn")})),i.createElement(s.InlineField,{label:"External ID",labelWidth:28,tooltip:"If you are assuming a role in another account, that has been created with an external ID, specify the external ID here."},i.createElement(s.Input,{className:"width-30",placeholder:"External ID",value:O.jsonData.externalId||"",onChange:u.onUpdateDatasourceJsonDataOption(e,"externalId")}))),!A&&i.createElement(s.InlineField,{label:"Endpoint",labelWidth:28,tooltip:"Optionally, specify a custom endpoint for the service"},i.createElement(s.Input,{className:"width-30",placeholder:null!==(g=e.defaultEndpoint)&&void 0!==g?g:"https://{service}.{region}.amazonaws.com",value:O.jsonData.endpoint||"",onChange:u.onUpdateDatasourceJsonDataOption(e,"endpoint")})),i.createElement(s.InlineField,{label:"Default Region",labelWidth:28,tooltip:"Specify the region, such as for US West (Oregon) use ` us-west-2 ` as the region."},i.createElement(s.Select,{className:"width-30",value:E.find((function(e){return e.value===O.jsonData.defaultRegion})),options:E,defaultValue:O.jsonData.defaultRegion,allowCustomValue:!0,onChange:u.onUpdateDatasourceJsonDataOptionSelect(e,"defaultRegion"),formatCreateLabel:function(e){return"Use region: "+e}})),e.children)},t.awsAuthProviderOptions=d,t.standardRegions=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),a=n(0),o=r.__importDefault(n(13));t.default=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={loading:!1});var i=a.useRef(0),s=o.default(),u=a.useState(n),l=u[0],c=u[1];return[l,a.useCallback((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var a=++i.current;return c((function(e){return r.__assign(r.__assign({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return s()&&a===i.current&&c({value:e,loading:!1}),e}),(function(e){return s()&&a===i.current&&c({error:e,loading:!1}),e}))}),t)]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(){var e=r.useRef(!1),t=r.useCallback((function(){return e.current}),[]);return r.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},function(e,t,n){"use strict";n.r(t);var r=n(1),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function s(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function l(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function d(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}function p(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var f,m,y=n(3),h=n(0),v=n.n(h);function g(e,t){return v.a.createElement("div",{className:"cheat-sheet-item__example",key:e,onClick:function(){return t({refId:"A",query:e,queryType:f.getTraceSummaries})}},v.a.createElement("code",null,e))}!function(e){e.getTrace="getTrace",e.getTraceSummaries="getTraceSummaries",e.getTimeSeriesServiceStatistics="getTimeSeriesServiceStatistics",e.getAnalyticsRootCauseResponseTimeService="getAnalyticsRootCauseResponseTimeService",e.getAnalyticsRootCauseResponseTimePath="getAnalyticsRootCauseResponseTimePath",e.getAnalyticsRootCauseErrorService="getAnalyticsRootCauseErrorService",e.getAnalyticsRootCauseErrorPath="getAnalyticsRootCauseErrorPath",e.getAnalyticsRootCauseErrorMessage="getAnalyticsRootCauseErrorMessage",e.getAnalyticsRootCauseFaultService="getAnalyticsRootCauseFaultService",e.getAnalyticsRootCauseFaultPath="getAnalyticsRootCauseFaultPath",e.getAnalyticsRootCauseFaultMessage="getAnalyticsRootCauseFaultMessage",e.getAnalyticsUser="getAnalyticsUser",e.getAnalyticsUrl="getAnalyticsUrl",e.getAnalyticsStatusCode="getAnalyticsStatusCode",e.getInsights="getInsights",e.getServiceMap="getServiceMap"}(f||(f={}));var b=n(8),E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.render=function(){return v.a.createElement("div",null,v.a.createElement(b.ConnectionConfig,i({},this.props)))},t}(h.PureComponent),w=n(2),S=n(5),_=n.n(S),T=n(9),x=n.n(T);function R(e,t){Object(h.useEffect)((function(){var n,a;t&&(x.a.emit(r.AppEvents.alertWarning,[e,(null===(a=null===(n=t)||void 0===n?void 0:n.data)||void 0===a?void 0:a.message)||t.message]),t.isHandled=!0)}),[t,e])}var A={label:"Trace List",value:"traceList"},O={label:"Insights",value:"insights",queryType:f.getInsights},C={label:"Service Map",value:"serviceMap",queryType:f.getServiceMap},N={label:"Trace Statistics",value:"traceStatistics",queryType:f.getTimeSeriesServiceStatistics},D=[A,N,O,{label:"Trace Analytics",value:"traceAnalytics",children:[{value:"rootCause",label:"Root Cause",children:[{value:"responseTime",label:"Response Time",children:[{value:"rootCauseService",label:"Root Cause",queryType:f.getAnalyticsRootCauseResponseTimeService},{value:"path",label:"Path",queryType:f.getAnalyticsRootCauseResponseTimePath}]},{value:"error",label:"Error",children:[{value:"rootCauseService",label:"Root Cause",queryType:f.getAnalyticsRootCauseErrorService},{value:"path",label:"Path",queryType:f.getAnalyticsRootCauseErrorPath},{value:"message",label:"Error Message",queryType:f.getAnalyticsRootCauseErrorMessage}]},{value:"fault",label:"Fault",children:[{value:"rootCauseService",label:"Root Cause",queryType:f.getAnalyticsRootCauseFaultService},{value:"path",label:"Path",queryType:f.getAnalyticsRootCauseFaultPath},{value:"message",label:"Error Message",queryType:f.getAnalyticsRootCauseFaultMessage}]}]},{value:"user",label:"End user impact",queryType:f.getAnalyticsUser},{value:"url",label:"URL",queryType:f.getAnalyticsUrl},{value:"statusCode",label:"HTTP status code",queryType:f.getAnalyticsStatusCode}]},C],F={"ErrorStatistics.ThrottleCount":"Throttle Count","ErrorStatistics.TotalCount":"Error Count","FaultStatistics.TotalCount":"Fault Count",OkCount:"Success Count",TotalCount:"Total Count","Computed.AverageResponseTime":"Average Response Time"},I={GroupName:"All",GroupARN:"All"};function j(e,t,n,r,a){Object(h.useEffect)((function(){var a=n.find((function(e){return"Default"===e.GroupName}))||n[0];if(e.queryType){var o=function(e,t,n){var r,a,o=e.group,i=t;e.queryType===f.getInsights&&(i=d([I],t));var s=i.find((function(t){var n;return t.GroupARN===(null===(n=e.group)||void 0===n?void 0:n.GroupARN)}));s?s.GroupName===(null===(r=e.group)||void 0===r?void 0:r.GroupName)&&s.FilterExpression===(null===(a=e.group)||void 0===a?void 0:a.FilterExpression)||(o=s):o=n;return o}(e,n,a),s=function(e,t){if(e.region){var n=t.find((function(t){return t.value===e.region}));if(n)return n.value}return"default"}(e,r);o===e.group&&s===e.region||t(i(i({},e),{group:o,region:s}))}else t(i(i({},e),{queryType:f.getTraceSummaries,query:"",group:a,region:"default"}))}),[e,n,r,t,a])}var q=n(10),P=n.n(q),k=[{label:"ok",documentation:"Response status code was 2XX Success."},{label:"error",documentation:"Response status code was 4XX Client Error."},{label:"throttle",documentation:"Response status code was 429 Too Many Requests."},{label:"fault",documentation:"Response status code was 5XX Server Error."},{label:"partial",documentation:"Request has incomplete segments."},{label:"inferred",documentation:"Request has inferred segments."},{label:"first",documentation:"Element is the first of an enumerated list."}],M=[{label:"responsetime",documentation:"Time that the server took to send a response."},{label:"duration",documentation:"Total request duration, including all downstream calls."},{label:"http.status",documentation:"Response status code."},{label:"index",documentation:"Position of an element in an enumerated list."},{label:"coverage",documentation:"Decimal percentage of entity response time over root segment response time. Applicable only for response time root cause entities."}],G=[{label:"http.url",documentation:"Request URL."},{label:"http.method",documentation:"Request method."},{label:"http.useragent",documentation:"Request user agent string."},{label:"http.clientip",documentation:"Requestor's IP address."},{label:"user",documentation:"Value of the user field on any segment in the trace."},{label:"name",documentation:"The name of a service or exception."},{label:"type",documentation:"Service type."},{label:"message",documentation:"Exception message."},{label:"availabilityzone",documentation:"Value of the availabilityzone field on any segment in the trace."},{label:"instance.id",documentation:"Value of the instance ID field on any segment in the trace."},{label:"resource.arn",documentation:"Value of the resource ARN field on any segment in the trace."}],U=[{label:"service",documentation:"service(_name_) {_filter_}\n     Service with name _name_.\n     Optional curly braces can contain a filter expression that applies to segments created by the service."},{label:"edge",documentation:"edge(_source_, _destination_) {_filter_}\n      Connection between services _source_ and _destination_.\n      Optional curly braces can contain a filter expression that applies to segments on this connection."},{label:"annotation",documentation:"annotation.key\n    Value of an annotation with field _key_.\n    The value of an annotation can be a Boolean, number, or string, so you can use any of the comparison operators of those types.\n    You can't use this keyword in combination with the service or edge keyword."},{label:"json",documentation:"JSON root cause object.\n    See Getting data from AWS X-Ray for steps to create JSON entities programmatically."},{label:"id",documentation:'id(name: "service-name", type:"service::type")\n    You can use the id function in place of a service name in service and edge filters.'}],V=d(k,M,G,U),K={function:{pattern:new RegExp("\\b(?:"+V.map((function(e){return e.label})).join("|")+")\\b","i")},punctuation:/[{}()`,]/,whitespace:/\s+/,boolean:/\btrue|false\b/,isTraceId:/^\d-\w{8}-\w{24}$/,logicalOperator:{pattern:/\band|or\b/i,alias:"builtin"},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/},L=[Object(w.BracesPlugin)(),Object(w.SlatePrism)({onlyIn:function(e){return"block"===e.object&&"code_block"===e.type},getSyntax:function(){return"xray"}})];function X(e){var t=this,n=Object(h.useRef)(e.query.queryType);Object(h.useEffect)((function(){n.current=e.query.queryType}),[e.query,e.query.queryType]),Object(h.useEffect)((function(){P.a.languages.xray=K}),[]);return v.a.createElement(w.QueryField,{additionalPlugins:L,query:e.query.query,portalOrigin:"xray",onChange:function(t){var n=e.query;(0,e.onChange)(i(i({},n),{query:t}))},onTypeahead:function(r){return s(t,void 0,Promise,(function(){var t;return u(this,(function(a){switch(a.label){case 0:return(t=e.datasource).languageProvider&&n.current!==f.getTrace?[4,t.languageProvider.provideCompletionItems(r)]:[2,{suggestions:[]}];case 1:return[2,a.sent()]}}))}))},placeholder:"Enter service name, annotation, trace ID.",onRunQuery:e.onRunQuery})}var B,W=Object(w.stylesFactory)((function(){return{tooltipLink:Object(y.css)(B||(B=p(["\n    color: #33a2e5;\n    &:hover {\n      color: #33a2e5;\n      filter: brightness(120%);\n    }\n  "],["\n    color: #33a2e5;\n    &:hover {\n      color: #33a2e5;\n      filter: brightness(120%);\n    }\n  "])))}}));function H(e){var t=e.datasource,n=e.query,r=e.onRunQuery,a=e.onChange,o=e.selectedOptions,s=W();return v.a.createElement("div",{style:{flex:1,display:"flex"}},v.a.createElement(w.InlineFormLabel,{className:"query-keyword",width:"auto"},"Query ",v.a.createElement(w.Tooltip,{placement:"top",content:v.a.createElement("span",null,"See"," ",v.a.createElement("a",{href:"https://docs.aws.amazon.com/xray/latest/devguide/xray-console-filters.html?icmpid=docs_xray_console",target:"_blank",rel:"noreferrer",className:s.tooltipLink},"X-Ray documentation")," ","for filter expression help."),theme:"info"},v.a.createElement(w.Icon,{className:"gf-form-help-icon gf-form-help-icon--right-normal",name:"info-circle",size:"sm"}))),v.a.createElement(X,{query:n,history:[],datasource:t,onRunQuery:function(){a(n),n.query&&r()},onChange:function(e){a(i(i({},n),{queryType:Z(o.map((function(e){return e.value})),e.query),query:e.query}))}}))}var J,Q,$=Object(w.stylesFactory)((function(){return{container:Object(y.css)(J||(J=p(["\n    display: flex;\n  "],["\n    display: flex;\n  "]))),link:Object(y.css)(Q||(Q=p(["\n    white-space: nowrap;\n  "],["\n    white-space: nowrap;\n  "])))}}));function z(e){var t=e.datasource,n=e.query,r=e.range,a=$();return v.a.createElement("div",{className:a.container},[["To X-Ray service map",t.getServiceMapUrl(n.region)],["Open in X-Ray console",t.getXrayUrlForQuery(n,r)]].map((function(e){var t=c(e,2),n=t[0],r=t[1];return v.a.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer",key:r},v.a.createElement("span",{className:"gf-form-label gf-form-label--btn "+a.link},v.a.createElement("i",{className:"fa fa-share-square-o"})," ",n))})))}function Y(e){return e&&e!==f.getTimeSeriesServiceStatistics?e===f.getTrace||e===f.getTraceSummaries?[A]:e===f.getInsights?[O]:function e(t,n){var r,a;void 0===n&&(n=D);try{for(var o=l(n),i=o.next();!i.done;i=o.next()){var s=i.value,u=[];if(s.queryType===t)return u.push(s),u;if(s.children){var c=e(t,s.children);if(c.length)return u.push.apply(u,d([s],c)),u}}}catch(e){r={error:e}}finally{try{i&&!i.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return[]}(e):[N]}function Z(e,t){var n,r,a;if(e[0]===A.value)return/^\d-\w{8}-\w{24}$/.test(t.trim())?f.getTrace:f.getTraceSummaries;var o=void 0,i=function(e){o=(null!==(a=null==o?void 0:o.children)&&void 0!==a?a:D).find((function(t){return t.value===e}))};try{for(var s=l(e),u=s.next();!u.done;u=s.next()){i(u.value)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o.queryType}var ee,te,ne,re=Object(w.stylesFactory)((function(){return{queryParamsRow:Object(y.css)(ee||(ee=p(["\n    flex-wrap: wrap;\n  "],["\n    flex-wrap: wrap;\n  "]))),spring:Object(y.css)(te||(te=p(["\n    flex: 1;\n  "],["\n    flex: 1;\n  "]))),regionSelect:Object(y.css)(ne||(ne=p(["\n    margin-right: 4px;\n  "],["\n    margin-right: 4px;\n  "])))}}));function ae(e){var t,n,r=e.query,a=e.onChange,o=e.datasource,s=e.onRunQuery,u=e.groups,l=e.range,c=e.regions,p=Y(r.queryType),m=d([{label:"default",value:"default",text:"default"}],c);j(r,a,u,m,o);var y=p[0]===O?d([I],u):u,h=re();return v.a.createElement("div",null,![O,C].includes(p[0])&&v.a.createElement("div",{className:"gf-form"},v.a.createElement(H,{query:r,datasource:o,onChange:a,onRunQuery:s,selectedOptions:p})),v.a.createElement("div",{className:"gf-form "+h.queryParamsRow},v.a.createElement("div",{className:"gf-form"},v.a.createElement(w.InlineFormLabel,{className:"query-keyword",width:"auto"},"Region"),v.a.createElement(w.Select,{className:h.regionSelect,options:m,value:r.region,onChange:function(e){return a(i(i({},r),{region:e.value}))},width:18,placeholder:"Choose Region",menuPlacement:"bottom",maxMenuHeight:500})),v.a.createElement("div",{className:"gf-form"},v.a.createElement(w.InlineFormLabel,{className:"query-keyword",width:"auto"},"Query Type"),v.a.createElement(w.ButtonCascader,{value:p.map((function(e){return e.value})),options:D,onChange:function(e){var t=Z(e,r.query||"");a(i(i({},r),{queryType:t,columns:t===f.getTimeSeriesServiceStatistics?["all"]:void 0}))}},p[p.length-1].label)),v.a.createElement("div",{className:"gf-form"},v.a.createElement(w.InlineFormLabel,{className:"query-keyword",width:"auto"},"Group"),v.a.createElement(w.Segment,{value:null===(t=r.group)||void 0===t?void 0:t.GroupName,options:y.map((function(e){return{value:e.GroupARN,label:e.GroupName}})),onChange:function(e){a(i(i({},r),{group:y.find((function(t){return t.GroupARN===e.value}))}))}})),v.a.createElement("div",{className:"gf-form"},p[0]===O&&v.a.createElement("div",{className:"gf-form"},v.a.createElement(w.InlineFormLabel,{className:"query-keyword",width:"auto"},"State"),v.a.createElement(w.Segment,{value:null!==(n=r.state)&&void 0!==n?n:"All",options:["All","Active","Closed"].map((function(e){return{value:e,label:e}})),onChange:function(e){a(i(i({},r),{state:e.value}))}}))),v.a.createElement("div",{className:"gf-form"},p[0]===N&&v.a.createElement("div",{className:"gf-form","data-testid":"resolution",style:{flexWrap:"wrap"}},v.a.createElement(w.InlineFormLabel,{className:"query-keyword",width:"auto"},"Resolution"),v.a.createElement(w.Segment,{value:r.resolution?r.resolution.toString()+"s":"auto",options:["auto","60s","300s"].map((function(e){return{value:e,label:e}})),onChange:function(e){var t=e.value;a(i(i({},r),{resolution:"auto"===t?void 0:parseInt(t,10)}))}}))),v.a.createElement("div",{className:h.spring}),v.a.createElement(z,{datasource:o,query:r,range:l})),p[0]===N&&v.a.createElement("div",{className:"gf-form","data-testid":"column-filter",style:{flexWrap:"wrap"}},v.a.createElement(w.InlineFormLabel,{className:"query-keyword",width:"auto"},"Columns"),v.a.createElement("div",{style:{flex:1}},v.a.createElement(w.MultiSelect,{allowCustomValue:!1,options:Object.keys(F).map((function(e){return{label:F[e],value:e}})),value:(r.columns||[]).map((function(e){return{label:F[e],value:e}})),onChange:function(e){return a(i(i({},r),{columns:e.map((function(e){return e.value}))}))},closeMenuOnSelect:!1,isClearable:!0,placeholder:"All columns",menuPlacement:"bottom"}))))}var oe=["ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-southeast-1","ap-southeast-2","ca-central-1","cn-north-1","cn-northwest-1","eu-central-1","eu-north-1","eu-west-1","eu-west-2","eu-west-3","me-south-1","sa-east-1","us-east-1","us-east-2","us-gov-east-1","us-gov-west-1","us-iso-east-1","us-isob-east-1","us-west-1","us-west-2"].map((function(e){return{label:e,value:e,text:e}}));var ie=n(4),se=n(6);function ue(e){return"function"==typeof e}var le=!1,ce={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e);le=e},get useDeprecatedSynchronousErrorHandling(){return le}};function de(e){setTimeout((function(){throw e}),0)}var pe={closed:!0,next:function(e){},error:function(e){if(ce.useDeprecatedSynchronousErrorHandling)throw e;de(e)},complete:function(){}},fe=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}();var me=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),ye=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n,r=this._parentOrParents,a=this._ctorUnsubscribe,o=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof e)r.remove(this);else if(null!==r)for(var s=0;s<r.length;++s){r[s].remove(this)}if(ue(o)){a&&(this._unsubscribe=void 0);try{o.call(this)}catch(e){t=e instanceof me?he(e.errors):[e]}}if(fe(i)){s=-1;for(var u=i.length;++s<u;){var l=i[s];if(null!==(n=l)&&"object"==typeof n)try{l.unsubscribe()}catch(e){t=t||[],e instanceof me?t=t.concat(he(e.errors)):t.push(e)}}}if(t)throw new me(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var a=n._parentOrParents;if(null===a)n._parentOrParents=this;else if(a instanceof e){if(a===this)return n;n._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return n;a.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function he(e){return e.reduce((function(e,t){return e.concat(t instanceof me?t.errors:t)}),[])}var ve=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),ge=function(e){function t(n,r,a){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=pe;break;case 1:if(!n){o.destination=pe;break}if("object"==typeof n){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new be(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new be(o,n,r,a)}return o}return o(t,e),t.prototype[ve]=function(){return this},t.create=function(e,n,r){var a=new t(e,n,r);return a.syncErrorThrowable=!1,a},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(ye),be=function(e){function t(t,n,r,a){var o,i=e.call(this)||this;i._parentSubscriber=t;var s=i;return ue(n)?o=n:n&&(o=n.next,r=n.error,a=n.complete,n!==pe&&(ue((s=Object.create(n)).unsubscribe)&&i.add(s.unsubscribe.bind(s)),s.unsubscribe=i.unsubscribe.bind(i))),i._context=s,i._next=o,i._error=r,i._complete=a,i}return o(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;ce.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=ce.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):de(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;de(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};ce.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),ce.useDeprecatedSynchronousErrorHandling)throw e;de(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!ce.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return ce.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(de(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(ge);var Ee=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new we(e,this.project,this.thisArg))},e}(),we=function(e){function t(t,n,r){var a=e.call(this,t)||this;return a.project=n,a.count=0,a.thisArg=r||a,a}return o(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(ge);function Se(e){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _e(e){var t=function(e){var t=e.map((function(e){var t,n,r=[{key:"name",value:e.Document.name,type:"string"}];if(r.push.apply(r,d(function(e){var t=[];if(!e)return t;return["ec2","ecs","elastic_beanstalk","region"].forEach((function(n){e[n]&&(Object(ie.isPlainObject)(e[n])?t.push.apply(t,d(Oe(e[n]))):t.push({key:n,value:e[n],type:"string"}))})),t}(e.Document.aws))),null===(n=null===(t=e.Document.http)||void 0===t?void 0:t.request)||void 0===n?void 0:n.url){var a=new URL(e.Document.http.request.url);r.push({key:"hostname",value:a.hostname,type:"string"})}return{serviceName:e.Document.name,tags:r}}));return Object(ie.keyBy)(t,"serviceName")}(e.Segments),n=[],r=[],a=e.Segments.map((function(e){var a,o=e.Document.name;!function e(t,n){var r;(null===(r=t.subsegments)||void 0===r?void 0:r.length)&&t.subsegments.forEach((function(r){n(r,t),e(r,n)}))}(e.Document,(function(e,r){var a,i;o=null!==(i=null===(a=t[e.name])||void 0===a?void 0:a.serviceName)&&void 0!==i?i:o,n.push(Te(e,o,r.id))}));var i=r.find((function(t){return t.spanID===e.Document.name+e.Document.origin}));return i||(i={duration:0,flags:1,logs:[],operationName:null!==(a=e.Document.origin)&&void 0!==a?a:e.Document.name,processID:e.Document.name,spanID:e.Document.name+e.Document.origin,startTime:1e6*e.Document.start_time,traceID:e.Document.trace_id},r.push(i)),Te(e.Document,e.Document.name,i.spanID)}));return{processes:t,traceID:e.Id,spans:d(n,a,r),warnings:null}}function Te(e,t,n){var r=[];return n&&r.push({refType:"CHILD_OF",spanID:n,traceID:e.trace_id}),{duration:e.end_time?1e6*e.end_time-1e6*e.start_time:0,flags:1,logs:[],operationName:e.name,processID:t,startTime:1e6*e.start_time,spanID:e.id,traceID:e.trace_id,stackTraces:Re(e),tags:Ae(e),references:r,errorIconColor:xe(e)}}function xe(e){return e.error?"#FFC46E":e.throttle?"mediumpurple":void 0}function Re(e){var t;if(null===(t=e.cause)||void 0===t?void 0:t.exceptions){var n=[];return e.cause.exceptions.forEach((function(e){var t,r=e.type+": "+e.message;null===(t=e.stack)||void 0===t||t.forEach((function(e){r=r.concat("\nat "+e.label+" ("+e.path+":"+e.line+")")})),n.push(r)})),n}}function Ae(e){var t=d(Oe({aws:e.aws}),Oe({http:e.http}),Oe({annotations:e.annotations}),Oe({metadata:e.metadata}),[{key:"in progress",value:Boolean(e.in_progress),type:"boolean"}]);return e.origin&&t.push({key:"origin",value:e.origin,type:"string"}),(e.error||e.fault||e.throttle)&&t.push({key:"error",value:!0,type:"boolean"}),t}function Oe(e){var t=[];if(!e)return t;var n,r=(n={},function e(t,r){Object.keys(t).forEach((function(a){var o=t[a],i=r?r+"."+a:a;if(Object(ie.isPlainObject)(o)&&Object.keys(o).length)return e(o,i);Array.isArray(o)?o.forEach((function(t,r){var a=i+"["+r+"]";Object(ie.isPlainObject)(t)?e(t,a):n[a]=t})):n[i]=o}))}(e,null),n);return Object.keys(r).map((function(e){var n=function(e,t,n){if(!t||Array.isArray(t)&&!t.length)return;return{key:e,type:n,value:t}}(e,r[e],Se(r[e]));n&&t.push(n)})),t}function Ce(e,t,n){var a,o,i,s,u,c=e.fields[0].values.toArray().map((function(e){return JSON.parse(e)})),p=null!==(u=null==n?void 0:n.showRequestCounts)&&void 0!==u&&u,f={name:w.NodeGraphDataFrameFieldNames.id,type:r.FieldType.string,values:new r.ArrayVector},m={name:w.NodeGraphDataFrameFieldNames.title,type:r.FieldType.string,values:new r.ArrayVector,config:{displayName:"Name"}},y={name:w.NodeGraphDataFrameFieldNames.subTitle,type:r.FieldType.string,values:new r.ArrayVector,config:{displayName:"Type"}},h={name:w.NodeGraphDataFrameFieldNames.mainStat,type:r.FieldType.number,values:new r.ArrayVector,config:{unit:"ms/t",displayName:"Average response time"}},v=p?{name:w.NodeGraphDataFrameFieldNames.secondaryStat,type:r.FieldType.string,values:new r.ArrayVector,config:{displayName:"Requests count"}}:{name:w.NodeGraphDataFrameFieldNames.secondaryStat,type:r.FieldType.number,values:new r.ArrayVector,config:{unit:"t/min",displayName:"Transactions per minute"}},g={name:w.NodeGraphDataFrameFieldNames.arc+"success",type:r.FieldType.number,values:new r.ArrayVector,config:{color:{fixedColor:"green",mode:r.FieldColorModeId.Fixed},displayName:"Success"}},b={name:w.NodeGraphDataFrameFieldNames.arc+"errors",type:r.FieldType.number,values:new r.ArrayVector,config:{color:{fixedColor:"semi-dark-yellow",mode:r.FieldColorModeId.Fixed},displayName:"Error"}},E={name:w.NodeGraphDataFrameFieldNames.arc+"faults",type:r.FieldType.number,values:new r.ArrayVector,config:{color:{fixedColor:"red",mode:r.FieldColorModeId.Fixed},displayName:"Fault"}},S={name:w.NodeGraphDataFrameFieldNames.arc+"throttled",type:r.FieldType.number,values:new r.ArrayVector,config:{color:{fixedColor:"purple",mode:r.FieldColorModeId.Fixed},displayName:"Throttled"}},_={name:w.NodeGraphDataFrameFieldNames.id,type:r.FieldType.string,values:new r.ArrayVector},T={name:w.NodeGraphDataFrameFieldNames.source,type:r.FieldType.string,values:new r.ArrayVector},x={name:w.NodeGraphDataFrameFieldNames.target,type:r.FieldType.string,values:new r.ArrayVector},R={name:"sourceName",type:r.FieldType.string,values:new r.ArrayVector},A={name:"targetName",type:r.FieldType.string,values:new r.ArrayVector},O={name:w.NodeGraphDataFrameFieldNames.mainStat,type:r.FieldType.string,values:new r.ArrayVector,config:{displayName:"Response percentage"}},C=p?{name:w.NodeGraphDataFrameFieldNames.secondaryStat,type:r.FieldType.string,values:new r.ArrayVector,config:{displayName:"Requests count"}}:{name:w.NodeGraphDataFrameFieldNames.secondaryStat,type:r.FieldType.number,values:new r.ArrayVector,config:{unit:"t/min",displayName:"Transactions per minute"}},N={},D=[],F=function(e){var t,n=e.SummaryStatistics?e:e.Edges[0],r=n.SummaryStatistics;if(f.values.add(e.ReferenceId),m.values.add(e.Name),y.values.add(e.Type),h.values.add((t=r).TotalResponseTime/t.TotalCount*1e3),p){var a=n.ResponseTimeHistogram.reduce((function(e,t){return e+t.Count}),0);v.values.add(a+" Request"+(a>1?"s":""))}else v.values.add(e.SummaryStatistics?Ne(r,e.StartTime,e.EndTime):Ne(r,e.Edges[0].StartTime,e.Edges[0].EndTime));g.values.add(De(r)),b.values.add(Ie(r)),E.values.add(je(r)),S.values.add(Fe(r)),N[e.ReferenceId]=e,D.push.apply(D,d(e.Edges.map((function(t){return{edge:t,source:e}}))))};try{for(var I=l(c),j=I.next();!j.done;j=I.next()){F(j.value)}}catch(e){a={error:e}}finally{try{j&&!j.done&&(o=I.return)&&o.call(I)}finally{if(a)throw a.error}}try{for(var q=l(D),P=q.next();!P.done;P=q.next()){var k=P.value,M=k.edge,G=k.source,U=N[M.ReferenceId];_.values.add(G.ReferenceId+"__"+U.ReferenceId),T.values.add(G.ReferenceId),x.values.add(M.ReferenceId),R.values.add(G.Name),A.values.add(U.Name);var V=M.SummaryStatistics,K=De(M.SummaryStatistics);if(1===K)O.values.add("Success "+(100*K).toFixed(2)+"%");else{var L=[[je(V),"Faults"],[Ie(V),"Errors"],[Fe(V),"Throttled"]].find((function(e){return 0!==e[0]}));L?O.values.add(L[1]+" "+(100*L[0]).toFixed(2)+"%"):O.values.add("N/A")}if(p){var X=M.ResponseTimeHistogram.reduce((function(e,t){return e+t.Count}),0);C.values.add(X+" Request"+(X>1?"s":""))}else C.values.add(Ne(M.SummaryStatistics,M.StartTime,M.EndTime))}}catch(e){i={error:e}}finally{try{P&&!P.done&&(s=q.return)&&s.call(q)}finally{if(i)throw i.error}}return[new r.MutableDataFrame({name:"nodes",refId:null==t?void 0:t.refId,fields:[f,m,y,h,v,g,E,b,S],meta:{preferredVisualisationType:"nodeGraph"}}),new r.MutableDataFrame({name:"edges",refId:null==t?void 0:t.refId,fields:[_,T,R,x,A,O,C],meta:{preferredVisualisationType:"nodeGraph"}})]}function Ne(e,t,n){return n&&t?e.TotalCount/((qe(n)-qe(t))/6e4):void 0}function De(e){return e.OkCount/e.TotalCount}function Fe(e){return e.ErrorStatistics.ThrottleCount/e.TotalCount}function Ie(e){return(e.ErrorStatistics.TotalCount-e.ErrorStatistics.ThrottleCount)/e.TotalCount}function je(e){return e.FaultStatistics.TotalCount/e.TotalCount}function qe(e){return"number"==typeof e?1e3*e:new Date(e).valueOf()}var Pe={prefixMatch:!0,label:"Boolean Keywords",items:k},ke={prefixMatch:!0,label:"Number Keywords",items:M},Me={prefixMatch:!0,label:"String Keywords",items:G},Ge={prefixMatch:!0,label:"Complex Keywords",items:U},Ue=function(e){function t(t,n){var r=e.call(this)||this;return r.request=function(){return s(r,void 0,void 0,(function(){return u(this,(function(e){return[2,Promise.resolve()]}))}))},r.start=function(){return s(r,void 0,void 0,(function(){return u(this,(function(e){return[2,[]]}))}))},r.getAllKeywords=function(){return{suggestions:[Pe,ke,Me,Ge]}},r.datasource=t,Object.assign(r,n),r}return o(t,e),t.prototype.provideCompletionItems=function(e){var t=e.value;return s(this,void 0,Promise,(function(){return u(this,(function(e){return t?[2,this.getAllKeywords()]:[2,{suggestions:[]}]}))}))},t}(r.LanguageProvider);function Ve(e,t,n){var r=function(e,t,n){return function(r,a,o){return{title:r,url:"",internal:{query:i(i({},n||{}),{queryType:a,query:e+(o?" "+o:"")}),datasourceUid:t.uid,datasourceName:t.name}}}}(e,t,n);return[r("Traces/All",f.getTraceSummaries),r("Traces/OK",f.getTraceSummaries,"{ ok = true }"),r("Traces/Errors",f.getTraceSummaries,"{ error = true }"),r("Traces/Faults",f.getTraceSummaries,"{ fault = true }"),r("Root cause/Error",f.getAnalyticsRootCauseErrorService),r("Root cause/Fault",f.getAnalyticsRootCauseFaultService),r("Root cause/Response Time",f.getAnalyticsRootCauseResponseTimeService)]}var Ke=function(e){function t(t){var n=e.call(this,t)||this;return n.languageProvider=new Ue(n),n.instanceSettings=t,n}return t.$inject=["instanceSettings"],o(t,e),t.prototype.query=function(t){var n,r,a=this,o=function(e,t){return i(i({},e),{targets:e.targets.map((function(n){var r=i({},n);if(r.queryType===f.getTimeSeriesServiceStatistics&&e.intervalMs&&!r.resolution){var a=Math.floor(e.intervalMs/1e3);r.resolution=a<=60?60:300}return r.query=t.replace(r.query,e.scopedVars),n.group&&n.group.FilterExpression&&n.queryType!==f.getTrace&&(r.query?r.query=n.group.FilterExpression+" AND "+r.query:r.query=n.group.FilterExpression),r}))})}(t,Object(se.getTemplateSrv)());return e.prototype.query.call(this,o).pipe((n=function(e){return i(i({},e),{data:e.data.flatMap((function(e){var n=t.targets.find((function(t){return t.refId===e.refId}));return a.parseResponse(e,n)}))})},function(e){if("function"!=typeof n)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return e.lift(new Ee(n,r))}))},t.prototype.getGroups=function(e){return s(this,void 0,Promise,(function(){var t,n;return u(this,(function(r){return t="",e&&(n=new URLSearchParams({region:e}),t="?"+n.toString()),[2,this.getResource("/groups"+t)]}))}))},t.prototype.getRegions=function(){return s(this,void 0,Promise,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return[4,this.getResource("/regions")];case 1:return e=t.sent(),[2,d(Object(ie.sortBy)(e.map((function(e){return{label:e.RegionName,value:e.RegionName,text:e.RegionName}})),"label"))]}}))}))},t.prototype.getServiceMapUrl=function(e){return this.getXrayUrl(e)+"#/service-map/"},t.prototype.getXrayUrlForQuery=function(e,t){var n,r=new URLSearchParams;switch(e.query&&r.append("filter",e.query),t&&r.append("timeRange",t.from.toISOString()+"~"+t.to.toISOString()),e.group&&"Default"!==e.group.GroupName&&r.append("group",e.group.GroupName),e.queryType){case f.getTraceSummaries:n="traces";break;case f.getTrace:n="traces/"+e.query,r=void 0;break;case f.getInsights:n="insights",r=void 0;break;case f.getTimeSeriesServiceStatistics:default:n="analytics"}var a=(null==r?void 0:r.toString())?"?"+(null==r?void 0:r.toString().replace(/\+/g,"%20").replace(/%3A/g,":").replace(/%7E/g,"~")):"";return this.getXrayUrl(e.region)+"#/"+n+a},t.prototype.getXrayUrl=function(e){return"https://"+(e=e&&"default"!==e?e:this.instanceSettings.jsonData.defaultRegion)+".console.aws.amazon.com/xray/home?region="+e},t.prototype.parseResponse=function(e,t){switch(e.name){case"Traces":return function(e,t){var n=e.fields[0].values.get(0),a=JSON.parse(n),o=a.Segments.map((function(e){return i(i({},e),{Document:JSON.parse(e.Document)})})),s=i(i({},a),{Segments:o});return[new r.MutableDataFrame({name:"Trace",refId:null==t?void 0:t.refId,fields:[{name:"trace",type:r.FieldType.trace,values:new r.ArrayVector([_e(s)])}],meta:{preferredVisualisationType:"trace"}})]}(e,t);case"TraceSummaries":return function(e,t,n){return e.fields.find((function(e){return e.name==="Id"})).config.links=[{title:"Trace: ${__value.raw}",url:"",internal:{datasourceUid:t.uid,datasourceName:t.name,query:i(i({},n||{}),{query:"${__value.raw}",queryType:"getTrace"})}}],[e]}(e,this.instanceSettings,t);case"InsightSummaries":return this.parseInsightsResponse(e,null==t?void 0:t.region);case"ServiceMap":return function(e,t,n){var r=c(Ce(e,n),2),a=r[0],o=r[1];a.fields[0].config={links:Ve('service(id(name: "${__data.fields.title}", type: "${__data.fields.subTitle}"))',t,n)};return o.fields[0].config={links:Ve('edge("${__data.fields.sourceName}", "${__data.fields.targetName}")',t,n)},[a,o]}(e,this.instanceSettings,t);case"TraceGraph":return Ce(e,t,{showRequestCounts:!0});default:return[e]}},t.prototype.parseInsightsResponse=function(e,t){var n=this.getXrayUrl(t)+"#/insights/",a=e.fields.find((function(e){return"InsightId"===e.name}));a&&(a.config.links=[{title:"",url:n+"${__value.raw}",targetBlank:!0}]);var o=e.fields.find((function(e){return"Duration"===e.name}));return o&&(o.type=r.FieldType.string,o.display=function(e){return{numeric:e,text:Le(Object(r.toDuration)(e))}}),[e]},t}(se.DataSourceWithBackend);function Le(e){var t="";return e.hours()&&(t=e.hours()+" hours "),e.minutes()&&(t+=e.minutes()+" minutes "),e.seconds()&&(t+=e.seconds()+" seconds"),t}n.d(t,"plugin",(function(){return Xe}));var Xe=new r.DataSourcePlugin(Ke).setConfigEditor(E).setExploreStartPage((function(e){var t=e.onClickExample;return v.a.createElement("div",null,v.a.createElement("h2",null,"X-Ray Cheat Sheet"),v.a.createElement("div",{className:"cheat-sheet-item"},v.a.createElement("p",null,v.a.createElement("span",null,"Use the search bar to display traces for a service, trace ID, or filter expression."),v.a.createElement("a",{target:"_blank",rel:"noreferrer",href:"https://docs.aws.amazon.com/console/xray/xray-filter-expressions"},"Learn more")),v.a.createElement("div",{className:"cheat-sheet-item__title"},"Filter expressions"),v.a.createElement("div",null,"You can use custom expressions to narrow down your search."),v.a.createElement("div",null,"Traces where response time was more than 5 seconds:"),g("responsetime > 5",t),v.a.createElement("div",null,"Traces where the total duration was 5 to 8 seconds:"),v.a.createElement("div",null,g("duration > 5 AND duration < 8",t)),v.a.createElement("div",null,"Traces that included a call to 'api.example.com' with a fault (500 series error) or response time above 2.5 seconds, and with one or more segments having an annotation named 'account' with value '12345':"),v.a.createElement("div",null,g('service("api.example.com") AND annotation.account = "12345"',t)),v.a.createElement("div",null,"Traces where the service 'api.example.com' made a call to 'backend.example.com' that failed with a fault:"),v.a.createElement("div",null,g('edge("api.example.com", "backend.example.com")',t)),v.a.createElement("div",null,"Traces where the URL begins with 'http://api.example.com/' and contains '/v2/' but does not reach a service named 'api.example.com':"),v.a.createElement("div",null,g('http.url BEGINSWITH "http://api.example.com/" AND http.url CONTAINS "/v2/" AND !service("api.example.com")',t)),v.a.createElement("div",null,"Traces that completed successfully in under 3 seconds, including all downstream calls:"),v.a.createElement("div",null,g("ok !partial duration < 3",t)),v.a.createElement("div",null,"If you have multiple services with the same name but different types, you can use an ID function to distinguish between them in a service or edge filter expression:"),v.a.createElement("div",null,g('service(id(name: "api.example.com", type: "AWS::EC2::Instance"))',t)),v.a.createElement("div",{className:"cheat-sheet-item"},v.a.createElement("div",{className:"cheat-sheet-item__title"},"Filter keywords"),v.a.createElement("table",{className:Object(y.css)(m||(m=p(["\n              td {\n                padding: 5px 10px 5px 10px;\n              }\n            "],["\n              td {\n                padding: 5px 10px 5px 10px;\n              }\n            "])))},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",null,"Attribute"),v.a.createElement("th",null,"Type"),v.a.createElement("th",null,"Description"))),v.a.createElement("tbody",null,v.a.createElement("tr",null,v.a.createElement("td",null,"ok"),v.a.createElement("td",null,"Boolean"),v.a.createElement("td",null,"Response status code was 2XX Success.")),v.a.createElement("tr",null,v.a.createElement("td",null,"error"),v.a.createElement("td",null,"Boolean"),v.a.createElement("td",null,"Response status code was 4XX Client Error.")),v.a.createElement("tr",null,v.a.createElement("td",null,"fault"),v.a.createElement("td",null,"Boolean"),v.a.createElement("td",null,"Response status code was 5XX Server Error.")),v.a.createElement("tr",null,v.a.createElement("td",null,"partial"),v.a.createElement("td",null,"Boolean"),v.a.createElement("td",null,"Request has incomplete segments.")),v.a.createElement("tr",null,v.a.createElement("td",null,"responsetime"),v.a.createElement("td",null,"Number"),v.a.createElement("td",null,"Time that the server took to send a response.")),v.a.createElement("tr",null,v.a.createElement("td",null,"duration"),v.a.createElement("td",null,"Number"),v.a.createElement("td",null,"Total request duration including all downstream calls.")),v.a.createElement("tr",null,v.a.createElement("td",null,"http.status"),v.a.createElement("td",null,"Number"),v.a.createElement("td",null,"Response status code.")),v.a.createElement("tr",null,v.a.createElement("td",null,"http.url"),v.a.createElement("td",null,"String"),v.a.createElement("td",null,"Request URL.")),v.a.createElement("tr",null,v.a.createElement("td",null,"http.method"),v.a.createElement("td",null,"String"),v.a.createElement("td",null,"Request method.")),v.a.createElement("tr",null,v.a.createElement("td",null,"http.useragent"),v.a.createElement("td",null,"String"),v.a.createElement("td",null,"Request user agent string.")),v.a.createElement("tr",null,v.a.createElement("td",null,"http.clientip"),v.a.createElement("td",null,"String"),v.a.createElement("td",null,"Requestor's IP address.")),v.a.createElement("tr",null,v.a.createElement("td",null,"user"),v.a.createElement("td",null,"String"),v.a.createElement("td",null,"Value of user field on any segment in the trace.")),v.a.createElement("tr",null,v.a.createElement("td",null,"annotation.*key*"),v.a.createElement("td",null,"String"),v.a.createElement("td",null,"Value of annotation with field *key*.")),v.a.createElement("tr",null,v.a.createElement("td",null,"service(*name*) "),v.a.createElement("td",null,"Complex"),v.a.createElement("td",null,"Service with name *name*. Optional curly braces can contain a filter expression that applies to segments created by the service.")),v.a.createElement("tr",null,v.a.createElement("td",null,"edge(*source*, *destination*) "),v.a.createElement("td",null,"Complex"),v.a.createElement("td",null,"Connection between services *source* and *destination*. Optional curly braces can contain a filter expression that applies to segments on this connection.")))))))})).setQueryEditor((function(e){var t=function(e){var t=this,n=_()((function(){return s(t,void 0,void 0,(function(){return u(this,(function(t){return[2,e.getRegions()]}))}))}),[e]);return R("Failed to load regions from AWS, showing default regions instead.",n.error),n.error?oe:n.loading?void 0:n.value}(e.datasource),n=function(e,t){var n=this,r=_()((function(){return s(n,void 0,void 0,(function(){return u(this,(function(n){return[2,e.getGroups(t)]}))}))}),[e,t]);return R("Failed to load groups",r.error),r.error?[{GroupARN:"default",GroupName:"Default"}]:r.value}(e.datasource,e.query.region);return n&&t?v.a.createElement(ae,i({},i(i({},e),{groups:n,regions:t}))):v.a.createElement(w.Spinner,null)}))}])}));
//# sourceMappingURL=module.js.map